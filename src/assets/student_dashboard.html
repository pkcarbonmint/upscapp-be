<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mentora Student Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; }
        .section-header { font-weight: 600; margin-bottom: 1.5rem; }
        .kpi-card .card-title { font-size: 1rem; font-weight: 500; color: #6c757d; }
        .kpi-card .card-text { font-size: 2.25rem; font-weight: 700; color: #212529; }
        .task-item { border-left: 4px solid; padding-left: 1rem; }
        .task-complete { border-color: #198754; }
        .task-pending { border-color: #ffc107; }
        .timeline-card-body { position: relative; padding-bottom: 30px; }
        .timeline-wrapper { position: relative; }
        .timeline-container { display: flex; width: 100%; height: 45px; transition: all 0.5s ease-in-out; }
        .timeline-segment { display: flex; align-items: center; justify-content: center; color: white; padding: 0 0.5rem; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 0.8rem; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.3); transition: all 0.4s ease-in-out; flex-shrink: 0; cursor: pointer; }
        .timeline-segment:last-child { border-right: none; }
        .timeline-segment.status-complete, .timeline-segment.status-upcoming { opacity: 0.6; transform: scaleY(0.85); }
        .timeline-segment.status-in-progress { opacity: 1; transform: scaleY(1.1); box-shadow: 0 0 15px rgba(13, 110, 253, 0.6); z-index: 5; }
        .timeline-segment.status-complete { background-color: #198754; }
        .timeline-segment.status-in-progress { background-color: #0d6efd; }
        .timeline-segment.status-upcoming { background-color: #e9ecef; color: #495057; border-right-color: rgba(0,0,0,0.1); }
        .date-markers-container { display: flex; margin-top: 15px; font-size: 0.75rem; color: #6c757d; transition: all 0.5s ease-in-out; }
        .date-marker { text-align: left; padding-left: 2px; white-space: nowrap; flex-shrink: 0; }
        .block-detail-panel { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-in-out, margin-top 0.4s ease-in-out, opacity 0.3s ease-in-out; opacity: 0; }
        .block-detail-panel.show { max-height: 500px; margin-top: 1.5rem !important; opacity: 1; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;

        // --- DATA ---
        const dashboardData = {
            student: { name: "Priya Sharma" },
            mentor: { name: "Dr. Arjun Verma" },
            kpis: [
                { title: "Plan Adherence", value: "88%" },
                { title: "Tasks This Week", value: "14/16" },
                { title: "Overall Progress", value: "35%" }
            ],
            studyTimeline: [
                { name: "Block 1: Ancient History", duration: 4, status: "complete", startDate: "2025-05-26", tasks: ["Complete R.S. Sharma chapters"], resources: ["R.S. Sharma - India's Ancient Past"] },
                { name: "Block 2: Medieval History", duration: 5, status: "complete", startDate: "2025-06-23", tasks: ["Read Satish Chandra thoroughly"], resources: ["Satish Chandra - History of Medieval India"] },
                { name: "Block 3: Modern History & Polity", duration: 6, status: "in-progress", startDate: "2025-07-28", tasks: ["Read Bipin Chandra and Laxmikanth"], resources: ["Bipin Chandra", "M. Laxmikanth"] },
                { name: "Block 4: Economy & Governance", duration: 4, status: "upcoming", startDate: "2025-09-08", tasks: ["Focus on NCERT concepts"], resources: ["NCERT Class XI & XII Economics"] }
            ],
            scoreSnapshots: [
                { date: "2025-06-15", scores: { 'Polity': 70, 'Modern History': 65, 'Economy': 55, 'Geography': 68, 'Environment': 72, 'Ancient History': 50 } },
                { date: "2025-07-15", scores: { 'Polity': 75, 'Modern History': 68, 'Economy': 60, 'Geography': 70, 'Environment': 75, 'Ancient History': 55 } },
                { date: "2025-08-15", scores: { 'Polity': 85, 'Modern History': 72, 'Economy': 65, 'Geography': 75, 'Environment': 80, 'Ancient History': 60 } }
            ],
            currentWeekSchedule: [
                { day: "Monday", task: "Read: Modern History - Ch. 4-5", status: "complete" },
                { day: "Tuesday", task: "Practice: 20 MCQs on Modern History", status: "complete" },
                { day: "Wednesday", task: "Revise: All topics from the week", status: "complete" },
                { day: "Thursday", task: "Read: Indian Polity - Ch. 1-3", status: "pending" },
                { day: "Friday", task: "Practice PYQ: Indian Polity - Ch. 1-3", status: "pending" },
                { day: "Saturday", task: "Catchup Day", status: "pending" },
                { day: "Sunday", task: "Polity Test", status: "pending" },
            ]
        };

        // --- REACT COMPONENTS (ALL COMPLETE AND FINAL) ---

        const Header = ({ studentName, mentor }) => (
            <header className="d-flex justify-content-between align-items-center mb-4 p-3 bg-white rounded shadow-sm">
                <div>
                    <h2 className="h4">Welcome, {studentName}!</h2>
                    <p className="text-muted mb-0">Your mentor: {mentor.name}</p>
                </div>
                <button className="btn btn-primary">Contact Mentor</button>
            </header>
        );

        const KpiCard = ({ title, value }) => (
            <div className="col-md-4 mb-4">
                <div className="card h-100 kpi-card">
                    <div className="card-body text-center">
                        <h6 className="card-title">{title}</h6>
                        <p className="card-text display-5">{value}</p>
                    </div>
                </div>
            </div>
        );

        const BlockDetailPanel = ({ block, onClose }) => (
            <div className={`card block-detail-panel ${block ? 'show' : ''}`}>
                <div className="card-body">
                    <div className="d-flex justify-content-between align-items-center">
                        <h5 className="mb-0">Details for: {block?.name}</h5>
                        <button type="button" className="btn-close" onClick={onClose} aria-label="Close"></button>
                    </div>
                    <hr />
                    <div className="row">
                        <div className="col-md-6">
                            <h6>Key Tasks</h6>
                            <ul className="list-group">{block?.tasks.map((task, i) => <li key={i} className="list-group-item">{task}</li>)}</ul>
                        </div>
                        <div className="col-md-6">
                            <h6>Core Resources</h6>
                            <ul className="list-group">{block?.resources.map((res, i) => <li key={i} className="list-group-item">{res}</li>)}</ul>
                        </div>
                    </div>
                </div>
            </div>
        );

        const StudyTimeline = ({ blocks, onBlockClick }) => {
            const [zoomLevel, setZoomLevel] = useState('full');
            if (!blocks || blocks.length === 0) return null;

            const totalDuration = blocks.reduce((sum, block) => sum + block.duration, 0);
            const getBlockWidth = (block) => {
                if (zoomLevel === 'current') {
                    if (block.status === 'in-progress') return '60%';
                    return '10%';
                }
                return (block.duration / totalDuration) * 100 + '%';
            };

            return (
                <div className="card">
                    <div className="card-body timeline-card-body">
                        <div className="d-flex justify-content-between align-items-center">
                            <h5 className="section-header mb-0">Overall Study Timeline</h5>
                            <div className="btn-group btn-group-sm">
                                <button className={`btn btn-outline-primary ${zoomLevel === 'full' ? 'active' : ''}`} onClick={() => setZoomLevel('full')}>Full View</button>
                                <button className={`btn btn-outline-primary ${zoomLevel === 'current' ? 'active' : ''}`} onClick={() => setZoomLevel('current')}>Current Block</button>
                            </div>
                        </div>
                        <hr/>
                        <div className="timeline-wrapper">
                            <div className="timeline-container">
                                {blocks.map((block, index) => (
                                    <div key={index} className={`timeline-segment status-${block.status}`} style={{ width: getBlockWidth(block) }} title={`${block.name} (${block.duration} weeks)`} onClick={() => onBlockClick(block)}><span>{block.name}</span></div>
                                ))}
                            </div>
                        </div>
                         <div className="date-markers-container">
                            {blocks.map((block, index) => (
                                <div key={index} className="date-marker" style={{ width: getBlockWidth(block) }}><span>{block.startDate.substring(5)}</span></div>
                            ))}
                         </div>
                    </div>
                </div>
            );
        };

        const WeeklySchedule = ({ schedule }) => (
            <div className="card h-100">
                <div className="card-body">
                    <h5 className="section-header">This Week's Plan</h5>
                    <ul className="list-unstyled mb-0">{schedule.map((item, index) => (<li key={index} className={`mb-3 task-item task-${item.status}`}><strong>{item.day}:</strong> {item.task}<span className={`badge float-end bg-${item.status === 'complete' ? 'success' : 'warning'}`}>{item.status}</span></li>))}</ul>
                </div>
            </div>
        );

        const ScoresChart = ({ snapshots }) => {
            const chartRef = useRef(null);
            const chartInstanceRef = useRef(null);
            const [snapshotIndex, setSnapshotIndex] = useState(snapshots.length - 1);

            const formatDate = (dateString) => {
                const date = new Date(dateString + "T00:00:00");
                return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            };

            useEffect(() => {
                if (!chartRef.current || !snapshots) return;
                const currentSnapshot = snapshots[snapshotIndex];
                const previousSnapshot = snapshotIndex > 0 ? snapshots[snapshotIndex - 1] : null;
                const labels = Object.keys(currentSnapshot.scores);
                const datasets = [{
                    label: `As of ${formatDate(currentSnapshot.date)}`,
                    data: Object.values(currentSnapshot.scores),
                    fill: true,
                    backgroundColor: 'rgba(13, 110, 253, 0.2)',
                    borderColor: 'rgb(13, 110, 253)',
                    pointBackgroundColor: 'rgb(13, 110, 253)',
                }];

                if (previousSnapshot) {
                    datasets.unshift({
                        label: `As of ${formatDate(previousSnapshot.date)}`,
                        data: Object.values(previousSnapshot.scores),
                        fill: true,
                        backgroundColor: 'rgba(108, 117, 125, 0.2)',
                        borderColor: 'rgb(108, 117, 125)',
                        pointBackgroundColor: 'rgb(108, 117, 125)',
                    });
                }

                if (chartInstanceRef.current) chartInstanceRef.current.destroy();
                const chartContext = chartRef.current.getContext('2d');
                chartInstanceRef.current = new Chart(chartContext, {
                    type: 'radar',
                    data: { labels, datasets },
                    options: {
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'top' } },
                        scales: { r: { suggestedMin: 0, suggestedMax: 100, pointLabels: { font: { size: 12 } } } }
                    }
                });
            }, [snapshots, snapshotIndex]);

            return (
                <div className="card h-100">
                    <div className="card-body d-flex flex-column">
                        <h5 className="section-header">Scores Progress</h5>
                        <div className="d-flex justify-content-center mb-3">
                            <div className="btn-group btn-group-sm" role="group">
                                {snapshots.map((snapshot, index) => (
                                    <button key={index} type="button" className={`btn ${snapshotIndex === index ? 'btn-primary' : 'btn-outline-secondary'}`} onClick={() => setSnapshotIndex(index)}>{formatDate(snapshot.date)}</button>
                                ))}
                            </div>
                        </div>
                        <div className="flex-grow-1" style={{ position: 'relative', minHeight: '300px' }}><canvas ref={chartRef}></canvas></div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [data, setData] = useState(dashboardData);
            const [selectedBlock, setSelectedBlock] = useState(null);
            const handleBlockClick = (block) => {
                setSelectedBlock(prevBlock => (prevBlock?.name === block.name ? null : block));
            };
            const handleClosePanel = () => {
                setSelectedBlock(null);
            };

            return (
                <div className="container py-4">
                    <Header studentName={data.student.name} mentor={data.mentor} />
                    <div className="row">{data.kpis.map(kpi => <KpiCard key={kpi.title} {...kpi} />)}</div>
                    <div className="my-4">
                        <StudyTimeline blocks={data.studyTimeline} onBlockClick={handleBlockClick} />
                        <BlockDetailPanel block={selectedBlock} onClose={handleClosePanel} />
                    </div>
                    <div className="row">
                        <div className="col-lg-7 mb-4"><WeeklySchedule schedule={data.currentWeekSchedule} /></div>
                        <div className="col-lg-5 mb-4"><ScoresChart snapshots={data.scoreSnapshots} /></div>
                    </div>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
